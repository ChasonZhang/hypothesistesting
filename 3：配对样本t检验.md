# 题目：
# 使用sleep数据集，比较两种药物对睡眠时间的影响是否有显著差异。

# 考点：

# 配对样本t检验的应用场景
# 配对设计与独立样本设计的区别
# 数据重塑与处理
# 配对前后差异的计算

# 配对样本t检验分析思路

## 一、基本概念

配对样本t检验是一种用于比较两组相关样本均值差异的统计方法。与独立样本t检验不同，配对样本t检验适用于样本之间存在对应关系的情况，比如：
- 同一受试者在不同时间点的测量
- 相匹配的对象（如兄弟姐妹、双胞胎）
- 同一对象在不同处理条件下的测量

配对设计的核心思想是通过排除个体差异来提高统计效力。

## 二、应用场景

配对样本t检验适用于以下场景：
1. **前后测设计**：比较同一组受试者在干预前后的变化
2. **交叉设计**：同一组受试者接受不同处理，比较处理效果
3. **匹配设计**：有意匹配的两组样本之间的比较
4. **重复测量**：同一对象在不同条件下的多次测量

## 三、统计假设

- **零假设(H₀)**：配对样本的均值差异为零（μd = 0）
- **备择假设(H₁)**：
  - 双侧检验：配对样本的均值差异不为零（μd ≠ 0）
  - 单侧检验：配对样本的均值差异大于零（μd > 0）或小于零（μd < 0）

## 四、分析步骤

### 1. 数据准备
- 确保数据符合配对设计
- 检查是否有缺失值
- 确认数据记录的对应关系

### 2. 探索性分析
- 描述性统计：计算两组数据的均值、标准差
- 计算配对差异（d值）
- 绘制差异的直方图或箱线图，检查其分布特征

### 3. 检验前提条件
- 配对差异（d值）应近似服从正态分布
  - 可通过直方图、QQ图或正态性检验（如Shapiro-Wilk检验）来评估
- 样本量不大时（n<30），正态性假设尤为重要

### 4. 执行t检验
- 计算每对观测值的差值d
- 计算差值的均值d̄和标准差sd
- 计算t统计量：t = d̄ / (sd/√n)，其中n为配对数量
- 计算p值和置信区间

### 5. 结果解释
- 当p < α时（通常α = 0.05），拒绝零假设，认为存在显著差异
- 分析置信区间，了解效应大小和方向
- 结合实际背景解释统计显著性的实际意义

## 五、R语言实现示例

使用sleep数据集分析两种药物对睡眠时间的影响：

```r
# 加载数据
data(sleep)

# 查看数据结构
str(sleep)
head(sleep)

# 进行配对样本t检验
t_test_result <- t.test(extra ~ group, data = sleep, paired = TRUE)
print(t_test_result)

# 计算配对差异
sleep_wide <- reshape(sleep, idvar = "ID", timevar = "group", direction = "wide")
sleep_wide$diff <- sleep_wide$extra.2 - sleep_wide$extra.1
summary(sleep_wide$diff)

# 可视化
boxplot(extra ~ group, data = sleep, 
        main = "两种药物对睡眠的影响", 
        names = c("药物1", "药物2"),
        ylab = "额外睡眠时间(小时)")
```

## 六、结果报告要点

一个完整的配对样本t检验报告应包含：

1. **研究问题与假设**：明确说明研究目的和统计假设
2. **方法描述**：说明使用配对设计的原因和数据收集方法
3. **描述性统计**：
   - 两组数据的样本量、均值和标准差
   - 配对差异的均值、标准差
4. **检验结果**：
   - t值、自由度、p值
   - 效应量（如Cohen's d）
   - 95%置信区间
5. **统计结论**：基于p值和置信区间的统计推断
6. **实际意义**：结果对实际问题的影响和意义

## 七、与独立样本t检验的比较

| 特征 | 配对样本t检验 | 独立样本t检验 |
|------|--------------|--------------|
| 样本关系 | 相关（配对） | 独立 |
| 自由度 | n-1（配对数-1） | n₁+n₂-2（总样本数-2） |
| 统计效力 | 通常更高（控制个体差异） | 相对较低 |
| 适用场景 | 前后测量、交叉设计 | 不相关组间比较 |
| 数据结构 | 需要明确的配对关系 | 不需要配对 |

## 八、注意事项与局限性

1. **配对设计的重要性**：确保配对是有意义的，能够有效减少误差
2. **缺失数据处理**：在配对设计中，如果一对中有一个值缺失，整对数据通常需要被排除
3. **正态性假设**：对于小样本，要特别关注差值的正态性假设
4. **异常值处理**：检查并适当处理异常值，避免对结果造成过大影响
5. **效应量报告**：不仅关注p值，还应报告效应量以判断实际意义

## 九、进阶分析选项

1. **非参数替代方法**：当正态性假设不满足时，可考虑使用Wilcoxon符号秩检验
2. **贝叶斯方法**：使用贝叶斯配对t检验获得后验概率分布
3. **多重比较校正**：当进行多次配对t检验时，考虑使用Bonferroni等方法校正p值
4. **功效分析**：事先计算所需样本量，或事后计算检验功效

通过以上完整分析思路，可以系统地实施配对样本t检验，并得出科学可靠的统计结论。