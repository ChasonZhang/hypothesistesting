# R语言扩展包effectplots
# https://mp.weixin.qq.com/s/ca6m_bW1bYBQQb2rgG3F3g

# 加载包
library(effectplots)    # 用于绘制效应图
library(OpenML)          # 用于加载数据
library(lightgbm)        # 用于训练模型

set.seed(1)

# 加载数据
df <- getOMLDataSet(data.id = 45106L)$data

# 选择变量
xvars <- c("year", "town", "driver_age", "car_weight", "car_power", "car_age")

# 笔记本电脑上耗时0.1秒
average_observed(df[xvars], y = df$claim_nb) |>
  update(to_factor = TRUE) |>   # 将离散数值转换为因子
  plot(share_y = "all")